/*
 *	Turpial JS Templating Engine Library V. 1.0.0
 *	Copyright Yorman Maricuto, May 2019.  
 * 	License MIT.
 * 	Social Media/Contact:
 *	@twitter: @MaricutoYorman
 *	@Instagram: maricuto
 *	@email: yerikmiller@gmail.com
 *	@number: +584267886875
 *	@github: yerikmiller
 * 	@project: guide | github.
 *	Micro Framework to create web components and a templating engine for user interfaces (UI).
 *	Turpial: The Venezuela's national bird.
 *
 * 	MADE IN: V E N E Z U E L A.
 * 	@Development Version. V. 1.0.0
 *
*/
"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Turpial=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.birds=[],this.un=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0===t?e:t},this.searchStr=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.search(e);return-1!==r&&(!0!==n||r)},this.replacement=function(t,e,n){return t.split(e).join(n)},this.find=function(t){return"string"==typeof t?document.getElementById(t):t},this.autoloader=this.un(n.autoloader,!1),this.autoloader_folder=this.un(n.autoloader_folder,""),this.cache=this.un(n.cache,"default"),this.public_path=this.un(n.public_path,""),this.core_path=this.un(n.core_path,""),this.folder=this.un(n.core_path,"/turpial/"),this.loader={},this.loader.show=this.un(n.loaderShow,null),this.loader.hide=this.un(n.loaderHide,null),this.views={},this.resources={},this.Pro=function(t){return new Promise(function(e){t();setInterval(function(){console.log(t)},500)})},this.component={set:function(t){var n=t.tag,r=e.un(t.extends,null);void 0===window.customElements.get(n)&&(null!==r&&(r={extends:r}),window.customElements.define(n,function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props;return _classCallCheck(this,r),_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,function(t){var e=function(e){return _toConsumableArray(document.getElementsByTagName(e)).forEach(function(e){t(e)}),"ready"};if(window.addEventListener("load",function(){return e(n)}),"complete"===document.readyState)return e(n)}(e)))}return _inherits(r,_wrapNativeSuper(HTMLElement)),r}(),r))}},this.view={application:this},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=async function(t){return new Promise(function(n){var r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done);r=!0){var l=a.value;document.head.appendChild(e.filesLoaded[l])}}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}})},this.models.fetch=function(t){var n=e.un(t.type,"script"),r=e.un(t.options,{cache:e.cache});if(void 0===t.ready&&(t.ready=function(){}),"string"==typeof t.file)var o=[t.file];else o=t.file;var i=e,a=(document.head,[]),c=[];t.getString=function(t){return t.clone().text()},t.fetching=async function(e){void 0!==i.filesLoaded[e]&&"script"===n&&i.filesLoaded[e].remove(),window.fetch(e,r).then(function(n){if("function"==typeof t.error&&200!==n.status)return t.error(n.status);200===n.status&&t.getString(n).then(function(t){c.push(t);var n=document.createElement("script");n.text=t,i.filesLoaded[e]=n,a.push(e)})})},function(e){var r=!0,o=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var f=u.value;t.fetching(f)}}catch(t){o=!0,l=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw l}}var p=0,h=setInterval(function(){var r=!1;if(1e4===(p+=70)&&(r=!0,console.warn("Â¡Impossible to load all files.")),a.length===e.length||!0===r){if(clearInterval(h),"script"===n)return i.inject(e),void t.ready();if("text"===n)return void t.ready(c)}},70)}(o)},this.fetch=function(t){return e.models.fetch(t)},this.include=function(t){return e.models.fetch(t)},this.controller.views={application:this,folder:"".concat(this.folder,"views/"),ext:".turpial.js",path:function(t){var e=t.views.split("/"),n=this.folder;if(1===e.length){var r=e[0];return n+="".concat(r).concat(this.ext),this.application.resources[r]={},n}var o=e.pop(),i=e.pop();r=o;return this.application.resources[i]={},this.application.resources[i][r]={},0===e.length?n+="".concat(i,"/").concat(r).concat(this.ext):(e.forEach(function(t){n+="".concat(t,"/")}),n+="".concat(i,"/").concat(r).concat(this.ext)),n}},this.view.load=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{folder:e.autoloader_folder,ready:function(){}},n=".turpial.js",r=e.app.parameters,o=e.app.controller_name,i=e.app.action_name,a="".concat(e.folder).concat(t.folder).concat(o);if("index"===o)var c="".concat(a).concat(n);else if(0===r.length&&"index"!==o&&void 0===i)c="".concat(a,"/index").concat(n);else if(0===r.length&&"undefined"!==i)c="".concat(a,"/").concat(i,"/index").concat(n);else{c="".concat(a,"/").concat(i);r.forEach(function(t){c+="/".concat(t)}),c+=n}var l={file:c,ready:function(){t.ready()}};"function"==typeof t.error&&(l.error=function(e){t.error(e)}),e.fetch(l),e.DataView=l},this.controller.routes={set:function(){var t=e;t.app={};var n=window.location.href.split("?"),r=(n=(n=n[0]).split("#"))[0].search(e.public_path);if(r>0){var o=(n=n[0].substr(r+e.public_path.length)).split("/"),i=0,a=0;t.app.parameters=[],o.forEach(function(e){""!=e&&(0===i&&(t.app.controller_name=e),1===i?t.app.action_name=e:i>1&&(t.app.parameters[a++]=e),i++)}),void 0===t.app.controller_name&&(t.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(t){var n=window.location.href,r=(n=(n=(n=(n=n.split("#"))[0]).split("?"))[0]).split("/");r=""===r.pop()?"":"/",!0===e.searchStr(t.path,"http")&&(n=""),window.history.pushState(e.un(t.object),"",e.un("".concat(n).concat(r).concat(t.path))),e.controller.routes.set(),e.urls.load();var o=e.un(t.title,!1);"string"==typeof o&&(document.title=o)},go:function(t){if("number"==typeof t)window.history.go(t);else if("back"===t)window.history.back();else{if("forward"!==t)return;window.history.forward()}e.controller.routes.set(),e.urls.load()}},this.router=function(t){"number"!=typeof t&&"string"!=typeof t?e.controller.routes.change(t):e.controller.routes.go(t)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(t){if("object"===_typeof(t)){"string"==typeof t.views&&(t.views=[t.views]);var n=[],r=e.controller.views;t.views.forEach(function(e,o){t.views=e,n[o]=r.path(t)}),e.fetch({file:n,ready:t.ready})}},this.urls={},this.urls.load=function(){var t=e.app.controller_name,n=e.app.action_name,r=e.app.parameters,o=e.un(e.urls[t],!1);if(!1!==o){e.un(o.loadController,!0);var i=e.un(o.loadAction,!0),a=e.un(o.loadParameters,1e3),c=e.un(e.urls[t][n],!1);return"function"==typeof o.self?"function"==typeof c&&!0===i?r.length>a?void o.self(function(){c(function(){})}):void o.self(function(){c(function(){e.view.load()})}):!1===i&&"string"==typeof n?void o.self(function(){c(function(){})}):void o.self(function(){e.view.load()}):void 0}e.view.load()},!0===n.autoloader&&(window.addEventListener("load",function(){e.urls.load()}),window.onpopstate=function(t){e.controller.routes.set(),e.urls.load()})}return _createClass(t,[{key:"map",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.birds[t];if("object"===_typeof(t)?n=t:void 0===n&&(n=this.find(t)),"object"===_typeof(e)){if(void 0===e[0])return n;n=n.children,e.forEach(function(t,r){n=void 0===e[r+1]?n[t]:n[t].children})}return n}},{key:"createMap",value:function(t){var e=(t=this.find(t)).getAttribute("id");if(void 0!==e){var n=document.getElementById(e);this.birds[e]=n}}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.map(t,e)}},{key:"selectorApp",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"object"===_typeof(e)&&!0===Number.isInteger(e[0])?this.map(t,e):e}},{key:"delete",value:function(t){(t=this.find(t)).remove()}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace-selector",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"==typeof e)var o=this.render(e),i=e;else o=e;if(null===o){var a=!1;o=e}else a=!0;var c=t;!0===r&&(n="replace-selector");var l=!1,u=c.parentNode;if("before"===n)u.insertBefore(o,c),l=o;else if("after"===n)u.insertBefore(o,c.nextSibling),l=o;else if("replace-selector"===n)u.replaceChild(o,c),l=o;else{if("inner"!==n)return console.warn("error-on-placement"),!1;!0===a?c.innerHTML=i:c.innerText=o,l=c}var s=c;return this.createMap(s),l}},{key:"insert",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner";return t=this.find(t),this.update(t,e,n,!1)}},{key:"render",value:function(t){var e=document.createElement("template");return e.innerHTML=t,e=e.content.firstElementChild}},{key:"mount",value:function(t,e){if("string"==typeof e)e=this.render(e);if(null!==e){var n=(t=this.find(t)).appendChild(e),r=t;return this.createMap(r),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(t){if(void 0!==t[0])return"";var e=[],n=0;Object.values(t).forEach(function(t){e[n++]=t});var r=[];n=0;Object.keys(t).forEach(function(t){r[n++]=t});var o="";n=0;return r.forEach(function(t,n){o+=" ".concat(t,'="').concat(e[n],'"')}),o}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"object"===_typeof(e)&&(e=this.settings(e));var r="<".concat(t).concat(e,">");return r+=n,"br"!==t&&(r+="</".concat(t,">")),r}},{key:"html",value:function(t,e,n){"code"===t&&(n=this.replacement(n,"<","&lt;"),n=this.replacement(n,">","&gt;"),n=this.replacement(n," ","&nbsp;"));if(void 0===n)n=e,e="";if("object"===_typeof(n)&&void 0!==n[0]){var r="";n.forEach(function(t,e){r+="".concat(t)});o=this.createTag(t,e,r)}else if("object"===_typeof(n))e=n,o=this.createTag(t,e,n="");else var o=this.createTag(t,e,n);return o}},{key:"el",value:function(t,e,n){return this.html(t,e,n)}}]),t}();

/*
 *  Turpial JS Library V. 1.0.0
 *  Copyright Yorman Maricuto, May 2019.  
 *  License MIT.
 *  Social Media/Contact:
 *  @twitter: @MaricutoYorman
 *  @Instagram: maricuto
 *  @email: yerikmiller@gmail.com
 *  @number: +584267886875
 *  @github: yerikmiller
 *  @project: guide | github.
 *  Micro Library to create web components with a simple template engine for user interfaces (UI).
 *  Easy XHR connections (POST & GET), inject Scripts and CSS whenever you want and make XHR requests.
 *  Turpial: The Venezuela's national bird.
 *
 *  MADE IN: V E N E Z U E L A.
 *
*/
"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=_unsupportedIterableToArray(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r,i=!0,a=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return i=t.done,t},e:function(t){a=!0,r=t},f:function(){try{i||null==o.return||o.return()}finally{if(a)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function _createSuper(t){return function(){var e,n=_getPrototypeOf(t);if(_isNativeReflectConstruct()){var o=_getPrototypeOf(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var o=[null];o.push.apply(o,e);var r=new(Function.bind.apply(t,o));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Turpial=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.birds=[],this.un=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0===t?e:t},this.searchStr=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.search(e);return-1!==o&&(!0!==n||o)},this.replacement=function(t,e,n){return t.split(e).join(n)},this.find=function(t){return"string"==typeof t?document.getElementById(t):t},this.ext=".turpial.js",this.allowStateEvents=this.un(n.allowStateEvents,!1),this.autoloader=this.un(n.autoloader,!1),this.autoloader_folder=this.un(n.autoloader_folder,""),this.cache=this.un(n.cache,"public"),this.public_path=this.un(n.public_path,""),this.core_path=this.un(n.core_path,""),this.folder=this.un(n.core_path,"/turpial/"),this.loader={},this.httpRequests=[],this.loader.show=this.un(n.loaderShow,null),this.loader.hide=this.un(n.loaderHide,null),this.views={},this.statusResources="loaded",this.resources={},this.myComponents=[],this.random_string=function(t){void 0===t&&(t=6);for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e},this.selectData=function(t,e,n,o){o=turpial.un(o,!1);var r="";return t.forEach(function(t,i){if(t[e]==n)return!0===o?void(r=i):void(r=t)}),r},this.component={applyProps:function(t,n){var o=function(){var e=document.querySelectorAll(t);Array.prototype.slice.call(e).forEach(function(t){n(t)})},r=function(){if("loading"===e.statusResources)var t=0,n=setInterval(function(){return t>6e3?(console.warn("error loading resources and applying components"),void clearInterval(n)):(t+=20,"loaded"===e.statusResources?(clearInterval(n),void o()):void 0)},20);else o()};window.addEventListener("load",function(){r()}),"complete"!==document.readyState||r()},set:function(t){var n=e,o=n.component,r=t.props,i=t.tag;n.myComponents.push({tag:i,props:r});var a=n.un(t.extends,null);if(null!==a&&(a={extends:a}),void 0===window.customElements)return n.component.olderVerBrow=function(){},void o.applyProps(i,r);void 0===window.customElements.get(i)&&window.customElements.define(i,function(e){_inherits(r,_wrapNativeSuper(HTMLElement));var n=_createSuper(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props;return _classCallCheck(this,r),n.call(this,function(t){o.applyProps(i,t)}(e))}return r}(),a)}},this.view={},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(t){var n,o=_createForOfIteratorHelper(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;"STYLE"===e.filesLoaded[r].tagName&&(e.filesLoaded[r].innerHTML=e.filesLoaded[r].text),document.head.appendChild(e.filesLoaded[r])}}catch(t){o.e(t)}finally{o.f()}},this.models.fetch=function(t){var n=e,o=t.type||"script",r=n.un(t.save,null),i=n.un(t.options,null),a=n.un(t.method,"GET");t.url=t.url||[],t.file=t.file||t.url,t.files=t.files||t.file;var s=t.files;void 0===t.ready&&(t.ready=function(){}),"string"==typeof s&&(s=[s]);document.head;var c=[],l=[];t.getString=function(t){return t.clone().text()},t.fetching=function(e){void 0!==n.filesLoaded[e]&&"script"===o&&n.filesLoaded[e].remove();var s=new XMLHttpRequest;s.open(a,e,!0);var u=[],f=[];if(null!==i){for(var p in i)f.push(i[p]);Object.keys(i).forEach(function(t,e){u.push([t,f[e]])}),u.forEach(function(t){s.setRequestHeader(t[0],t[1])})}if(s.onload=function(){if(s.status>=200&&s.status<400){var r,i=s.responseText;l.push(i),r="script"===o||"style"===o||"link"===o?o:"script";var a=document.createElement(r);"style"===o?a.type="text/css":"link"===o&&(a.rel="stylesheet",a.media="all",a.href=e),a.text=i,n.filesLoaded[e]=a,c.push(e)}else if("function"==typeof t.onerror&&s.status>=400)return t.onerror(s.status)},!0===r){var d="rq_"+n.un(t.id,n.random_string(4));if(void 0!==n.httpRequests[d])try{n.httpRequests[d].abort()}catch(t){console.warn("unable to cancel request.")}n.httpRequests[d]=s}"POST"!==a?s.send():s.send(t.data)},n.statusResources="loading",function(e){var r,i=_createForOfIteratorHelper(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.fetching(a)}}catch(t){i.e(t)}finally{i.f()}var s=0,l=setInterval(function(){var r=!1;if(1e4===(s+=70)&&(r=!0,console.warn("Â¡Impossible to load all files.")),c.length!==e.length&&!0!==r);else{if(clearInterval(l),"script"===o||"style"===o||"link"===o)n.inject(e),t.ready();else if("text"===o){var i,a=[],u=_createForOfIteratorHelper(e);try{for(u.s();!(i=u.n()).done;){var f=i.value;a.push(n.filesLoaded[f].innerHTML)}}catch(t){u.e(t)}finally{u.f()}t.ready(a)}n.statusResources="loaded"}},70)}(s)},this.fetch=function(t){return e.models.fetch(t)},this.include=function(t){return e.models.fetch(t)},this.linkCSS=function(t){return t.type="link",e.models.fetch(t)},this.includeCSS=function(t){return t.type="style",e.models.fetch(t)},this.controller.views={path:function(t){var n=e.ext,o="".concat(e.folder,"views/"),r=t.views,i=e.resources,a=r.split("/"),s=o;if(1===a.length){var c=a[0];return s+="".concat(c).concat(n),i[c]={},s}var l=a.pop(),u=a.pop();c=l;return i[u]={},i[u][c]={},0===a.length?s+="".concat(u,"/").concat(c).concat(n):(a.forEach(function(t){s+="".concat(t,"/")}),s+="".concat(u,"/").concat(c).concat(n)),s}},this.view.load=function(t){t=t||{folder:e.autoloader_folder,ready:function(){}};var n=e.ext,o=e.app.parameters,r=e.app.controller_name,i=e.app.action_name,a="".concat(e.folder).concat(t.folder).concat(r);if(t.module=turpial.un(t.module,null),"index"===r)var s="".concat(a).concat(n);else if(0===o.length&&"index"!==r&&void 0===i)s="".concat(a,"/index").concat(n);else if(0===o.length&&"undefined"!==i)s="".concat(a,"/").concat(i,"/index").concat(n);else{s="".concat(a,"/").concat(i);o.forEach(function(t){s+="/".concat(t)}),s+=n}"string"==typeof t.module&&(t.ext=t.ext||n,s=e.core_path+t.module+t.ext);var c={file:s,options:t.options||{},ready:function(){t.ready()}};"function"==typeof t.error&&(c.error=function(e){t.error(e)}),e.DataView=c,""!==t.module&&!1!==t.module&&e.fetch(c)},this.controller.routes={set:function(){var t=e;t.app={};var n=window.location.href.split("?"),o=(n=(n=n[0]).split("#"))[0].search(t.public_path);if(o>0){var r=(n=n[0].substr(o+t.public_path.length)).split("/"),i=0,a=0;t.app.parameters=[],r.forEach(function(e){""!=e&&(0===i&&(t.app.controller_name=e),1===i?t.app.action_name=e:i>1&&(t.app.parameters[a++]=e),i++)}),void 0===t.app.controller_name&&(t.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(t){var n=e,o=window.location.href,r=(o=(o=(o=(o=o.split("#"))[0]).split("?"))[0]).split("/");r=""===r.pop()?"":"/",!0===n.searchStr(t.path,"http")&&(o=""),window.history.pushState(n.un(t.object),"",n.un("".concat(o).concat(r).concat(t.path))),n.controller.routes.set(),n.urls.load(t);var i=n.un(t.title,!1);"string"==typeof i&&(document.title=i)},go:function(t){if("number"==typeof t)window.history.go(t);else if("back"===t)window.history.back();else{if("forward"!==t)return;window.history.forward()}e.controller.routes.set(),e.urls.load()}},this.router=function(t){"number"!=typeof t&&"string"!=typeof t?(e.controller.routes.change(t),e.stateEvent()):e.controller.routes.go(t)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(t){if("object"===_typeof(t)){"string"==typeof t.views&&(t.views=[t.views]);var n=[],o=e.controller.views;t.views.forEach(function(e,r){t.views=e,n[r]=o.path(t)}),Object.assign(t,{file:n,ready:t.ready}),e.fetch(t)}},this.urls={},this.urls.load=function(t){t=t||{};var n=e,o=n.app.controller_name,r=n.app.action_name,i=n.app.parameters,a=n.urls[o]||!1;if(t.module=turpial.un(t.module,null),"string"!=typeof t.module){if(!1!==a){n.un(a.loadController,!0);var s=n.un(a.loadAction,!0),c=n.un(a.loadParameters,1e3),l=n.un(n.urls[o][r],!1);return"function"==typeof a.self?"function"==typeof l&&!0===s?i.length>c?void a.self(function(){l(function(){})}):void a.self(function(){l(function(){n.view.load(t)})}):!1===s&&"string"==typeof r?void a.self(function(){l(function(){})}):void a.self(function(){n.view.load(t)}):void 0}n.view.load(t)}else n.view.load(t)},this.historyEvents={},this.URLNoHASH=function(t){return t.split("#")[0]},this.createHistoryEvent=function(t,e){t=this.URLNoHASH(window.location.href)+(t=t||""),this.historyEvents[t]=e},this.createHistoryEvent("",function(){}),this.stateEvent=function(){var t=e.historyEvents;"function"==typeof t[e.URLNoHASH(window.location.href)]&&t[e.URLNoHASH(window.location.href)]()},!0===this.allowStateEvents&&window.addEventListener("popstate",this.stateEvent),!0===n.autoloader&&(window.addEventListener("load",function(){e.urls.load()}),window.onpopstate=function(t){e.controller.routes.set(),e.urls.load(),function(){void 0===window.customElements&&Array.prototype.slice.call(this.myComponents).forEach(function(t){this.component.set({tag:t.tag,props:t.props})})}()})}return _createClass(t,[{key:"map",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.birds[t];if("object"===_typeof(t)?n=t:void 0===n&&(n=this.find(t)),"object"===_typeof(e)){if(void 0===e[0])return n;n=n.children,e.forEach(function(t,o){n=void 0===e[o+1]?n[t]:n[t].children})}return n}},{key:"createMap",value:function(t){var e=(t=this.find(t)).getAttribute("id");if(void 0!==e){var n=document.getElementById(e);this.birds[e]=n}}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.map(t,e)}},{key:"selectorApp",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"object"===_typeof(e)&&!0===Number.isInteger(e[0])?this.map(t,e):e}},{key:"delete",value:function(t){(t=this.find(t)).remove()}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace-selector",o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"==typeof e)var r=this.render(e),i=e;else r=e;if(null===r){var a=!1;r=e}else a=!0;var s=t;!0===o&&(n="replace-selector");var c=!1,l=s.parentNode;if("before"===n)l.insertBefore(r,s),c=r;else if("after"===n)l.insertBefore(r,s.nextSibling),c=r;else if("replace-selector"===n)l.replaceChild(r,s),c=r;else{if("inner"!==n)return console.warn("error-on-placement"),!1;!0===a?s.innerHTML=i:s.innerText=r,c=s}var u=s;return this.createMap(u),c}},{key:"insert",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner";return t=this.find(t),this.update(t,e,n,!1)}},{key:"render",value:function(t){var e=document.createElement("template");return e.innerHTML=t,e=e.content.firstElementChild}},{key:"mount",value:function(t,e){if("string"==typeof e)e=this.render(e);if(null!==e){var n=(t=this.find(t)).appendChild(e),o=t;return this.createMap(o),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(t){if(void 0===t[0]){var e=[],n=0,o=[];for(var r in t)o.push(t[r]);o.forEach(function(t){e[n++]=t});var i=[];n=0;Object.keys(t).forEach(function(t){i[n++]=t});var a="";n=0;return i.forEach(function(t,n){a+=" ".concat(t,'="').concat(e[n],'"')}),a}}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"object"===_typeof(e)&&(e=this.settings(e));var o="<".concat(t).concat(e,">");return o+=n,"br"!==t&&(o+="</".concat(t,">")),o}},{key:"html",value:function(t,e,n){var o=this.replacement;if("code"===t&&(n=o(n,"<","&lt;"),n=o(n,">","&gt;"),n=o(n," ","&nbsp;")),void 0===n)n=e,e="";if("object"===_typeof(n)&&void 0!==n[0]){var r="";n.forEach(function(t,e){r+="".concat(t)});i=this.createTag(t,e,r)}else if("object"===_typeof(n))e=n,i=this.createTag(t,e,n="");else var i=this.createTag(t,e,n);return i}},{key:"el",value:function(t,e,n){return this.html(t,e,n)}}]),t}();
/*
 *  Turpial JS Templating Engine Library V. 1.0.0
 *  Copyright Yorman Maricuto, May 2019.  
 *  License MIT.
 *  Social Media/Contact:
 *  @twitter: @MaricutoYorman
 *  @Instagram: maricuto
 *  @email: yerikmiller@gmail.com
 *  @number: +584267886875
 *  @github: yerikmiller
 *  @project: guide | github.
 *  Micro Framework to create web components and a templating engine for user interfaces (UI).
 *  Turpial: The Venezuela's national bird.
 *
 *  MADE IN: V E N E Z U E L A.
 *  @Development Version. V. 1.0.0
 *
*/
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,o)}function o(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(o,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,o){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,o){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return o&&_setPrototypeOf(n,o.prototype),n}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Turpial=function(){function t(t){var e=this;void 0===t&&(t={}),this.birds=[],this.un=function(t,e){return void 0===e&&(e=""),void 0===t?e:t},this.searchStr=function(t,e,o){void 0===o&&(o=!1);var r=t.search(e);return-1!==r&&(!0!==o||r)},this.replacement=function(t,e,o){return t.split(e).join(o)},this.find=function(t){return"string"==typeof t?document.getElementById(t):t},this.ext=".turpial.js",this.autoloader=this.un(t.autoloader,!1),this.autoloader_folder=this.un(t.autoloader_folder,""),this.cache=this.un(t.cache,"public"),this.public_path=this.un(t.public_path,""),this.core_path=this.un(t.core_path,""),this.folder=this.un(t.core_path,"/turpial/"),this.loader={},this.loader.show=this.un(t.loaderShow,null),this.loader.hide=this.un(t.loaderHide,null),this.views={},this.statusResources="loaded",this.resources={},this.myComponents=[],this.component={applyProps:function(t,o){var r=function(){var e=document.querySelectorAll(t);Array.prototype.slice.call(e).forEach(function(t){o(t)})},n=function(){if("loading"===e.statusResources)var t=0,o=setInterval(function(){return t>6e3?(console.warn("error loading resources and applying components"),void clearInterval(o)):(t+=20,"loaded"===e.statusResources?(clearInterval(o),void r()):void 0)},20);else r()};window.addEventListener("load",function(){n()}),"complete"!==document.readyState||n()},set:function(t){var o=e,r=o.component,n=t.props,i=t.tag;o.myComponents.push({tag:i,props:n});var s=o.un(t.extends,null);if(null!==s&&(s={extends:s}),void 0===window.customElements)return o.component.olderVerBrow=function(){},void r.applyProps(i,n);void 0===window.customElements.get(i)&&window.customElements.define(i,function(e){function o(o){return void 0===o&&(o=t.props),e.call(this,function(t){r.applyProps(i,t)}(o))||this}return _inheritsLoose(o,e),o}(_wrapNativeSuper(HTMLElement)),s)}},this.view={},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(t){var o=t,r=Array.isArray(o),n=0;for(o=r?o:o[Symbol.iterator]();;){var i;if(r){if(n>=o.length)break;i=o[n++]}else{if((n=o.next()).done)break;i=n.value}var s=i;document.head.appendChild(e.filesLoaded[s])}},this.models.fetch=function(t){var o=e,n=o.un(t.type,"script"),i=o.un(t.options,null),s=o.un(t.method,"GET");void 0!==t.data&&(t.file=t.data),void 0!==t.files&&(t.file=t.files);var a=t.file;void 0===t.ready&&(t.ready=function(){}),"string"==typeof a&&(a=[a]);document.head;var c=[],u=[];t.getString=function(t){return t.clone().text()},t.fetching=function(e){void 0!==o.filesLoaded[e]&&"script"===n&&o.filesLoaded[e].remove();var a=new XMLHttpRequest;a.open(s,e,!0);var l=[],f=[];if(null!==i){for(var p in i)f.push(i[p]);Object.keys(i).forEach(function(t,e){l.push([t,f[e]])}),l.forEach(function(t){a.setRequestHeader(t[0],t[1])})}a.onload=function(){if(a.status>=200&&a.status<400){var n=a.responseText;u.push(n);var i=document.createElement("script");i.text=n,o.filesLoaded[e]=i,c.push(e)}else if("function"==typeof t.error&&200!==r.status)return t.error(a.status)},a.send()},o.statusResources="loading",function(e){var r=e,i=Array.isArray(r),s=0;for(r=i?r:r[Symbol.iterator]();;){var a;if(i){if(s>=r.length)break;a=r[s++]}else{if((s=r.next()).done)break;a=s.value}var u=a;t.fetching(u)}var l=0,f=setInterval(function(){var r=!1;if(1e4===(l+=70)&&(r=!0,console.warn("Â¡Impossible to load all files.")),c.length!==e.length&&!0!==r);else{if(clearInterval(f),"script"===n)o.inject(e),t.ready();else if("text"===n){var i=[],s=e,a=Array.isArray(s),u=0;for(s=a?s:s[Symbol.iterator]();;){var p;if(a){if(u>=s.length)break;p=s[u++]}else{if((u=s.next()).done)break;p=u.value}var d=p;i.push(o.filesLoaded[d].innerHTML)}t.ready(i)}o.statusResources="loaded"}},70)}(a)},this.fetch=function(t){return e.models.fetch(t)},this.include=function(t){return e.models.fetch(t)},this.controller.views={path:function(t){var o=e.ext,r=e.folder+"views/",n=t.views,i=e.resources,s=n.split("/"),a=r;if(1===s.length){var c=s[0];return a+=""+c+o,i[c]={},a}var u=s.pop(),l=s.pop();c=u;return i[l]={},i[l][c]={},0===s.length?a+=l+"/"+c+o:(s.forEach(function(t){a+=t+"/"}),a+=l+"/"+c+o),a}},this.view.load=function(t){void 0===t&&(t={folder:e.autoloader_folder,ready:function(){}});var o=e.ext,r=e.app.parameters,n=e.app.controller_name,i=e.app.action_name,s=""+e.folder+t.folder+n;if("index"===n)var a=""+s+o;else if(0===r.length&&"index"!==n&&void 0===i)a=s+"/index"+o;else if(0===r.length&&"undefined"!==i)a=s+"/"+i+"/index"+o;else{a=s+"/"+i;r.forEach(function(t){a+="/"+t}),a+=o}var c={file:a,ready:function(){t.ready()}};"function"==typeof t.error&&(c.error=function(e){t.error(e)}),e.fetch(c),e.DataView=c},this.controller.routes={set:function(){var t=e;t.app={};var o=window.location.href.split("?"),r=(o=(o=o[0]).split("#"))[0].search(t.public_path);if(r>0){var n=(o=o[0].substr(r+t.public_path.length)).split("/"),i=0,s=0;t.app.parameters=[],n.forEach(function(e){""!=e&&(0===i&&(t.app.controller_name=e),1===i?t.app.action_name=e:i>1&&(t.app.parameters[s++]=e),i++)}),void 0===t.app.controller_name&&(t.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(t){var o=e,r=window.location.href,n=(r=(r=(r=(r=r.split("#"))[0]).split("?"))[0]).split("/");n=""===n.pop()?"":"/",!0===o.searchStr(t.path,"http")&&(r=""),window.history.pushState(o.un(t.object),"",o.un(""+r+n+t.path)),o.controller.routes.set(),o.urls.load();var i=o.un(t.title,!1);"string"==typeof i&&(document.title=i)},go:function(t){if("number"==typeof t)window.history.go(t);else if("back"===t)window.history.back();else{if("forward"!==t)return;window.history.forward()}e.controller.routes.set(),e.urls.load()}},this.router=function(t){"number"!=typeof t&&"string"!=typeof t?e.controller.routes.change(t):e.controller.routes.go(t)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(t){if("object"===_typeof(t)){"string"==typeof t.views&&(t.views=[t.views]);var o=[],r=e.controller.views;t.views.forEach(function(e,n){t.views=e,o[n]=r.path(t)}),Object.assign(t,{file:o,ready:t.ready}),e.fetch(t)}},this.urls={},this.urls.load=function(){var t=e,o=t.app.controller_name,r=t.app.action_name,n=t.app.parameters,i=t.un(t.urls[o],!1);if(!1!==i){t.un(i.loadController,!0);var s=t.un(i.loadAction,!0),a=t.un(i.loadParameters,1e3),c=t.un(t.urls[o][r],!1);return"function"==typeof i.self?"function"==typeof c&&!0===s?n.length>a?void i.self(function(){c(function(){})}):void i.self(function(){c(function(){t.view.load()})}):!1===s&&"string"==typeof r?void i.self(function(){c(function(){})}):void i.self(function(){t.view.load()}):void 0}t.view.load()},!0===t.autoloader&&(window.addEventListener("load",function(){e.urls.load()}),window.onpopstate=function(t){e.controller.routes.set(),e.urls.load(),function(){void 0===window.customElements&&Array.prototype.slice.call(this.myComponents).forEach(function(t){this.component.set({tag:t.tag,props:t.props})})}()})}var e=t.prototype;return e.map=function(t,e){void 0===e&&(e=[]);var o=this.birds[t];if("object"===_typeof(t)?o=t:void 0===o&&(o=this.find(t)),"object"===_typeof(e)){if(void 0===e[0])return o;o=o.children,e.forEach(function(t,r){o=void 0===e[r+1]?o[t]:o[t].children})}return o},e.createMap=function(t){var e=(t=this.find(t)).getAttribute("id");if(void 0!==e){var o=document.getElementById(e);this.birds[e]=o}},e.read=function(t,e){return void 0===e&&(e=[]),this.map(t,e)},e.selectorApp=function(t,e){return void 0===e&&(e=[]),"object"===_typeof(e)&&!0===Number.isInteger(e[0])?this.map(t,e):e},e.delete=function(t){(t=this.find(t)).remove()},e.update=function(t,e,o,r){if(void 0===e&&(e=null),void 0===o&&(o="replace-selector"),void 0===r&&(r=!0),"string"==typeof e)var n=this.render(e),i=e;else n=e;if(null===n){var s=!1;n=e}else s=!0;var a=t;!0===r&&(o="replace-selector");var c=!1,u=a.parentNode;if("before"===o)u.insertBefore(n,a),c=n;else if("after"===o)u.insertBefore(n,a.nextSibling),c=n;else if("replace-selector"===o)u.replaceChild(n,a),c=n;else{if("inner"!==o)return console.warn("error-on-placement"),!1;!0===s?a.innerHTML=i:a.innerText=n,c=a}var l=a;return this.createMap(l),c},e.insert=function(t,e,o){return void 0===o&&(o="inner"),t=this.find(t),this.update(t,e,o,!1)},e.render=function(t){var e=document.createElement("template");return e.innerHTML=t,e=e.content.firstElementChild},e.mount=function(t,e){if("string"==typeof e)e=this.render(e);if(null!==e){var o=(t=this.find(t)).appendChild(e),r=t;return this.createMap(r),o}console.warn("need to be HTML string or object")},e.settings=function(t){if(void 0===t[0]){var e=[],o=0,r=[];for(var n in t)r.push(t[n]);r.forEach(function(t){e[o++]=t});var i=[];o=0;Object.keys(t).forEach(function(t){i[o++]=t});var s="";o=0;return i.forEach(function(t,o){s+=" "+t+'="'+e[o]+'"'}),s}},e.createTag=function(t,e,o){void 0===e&&(e=""),void 0===o&&(o=""),"object"===_typeof(e)&&(e=this.settings(e));var r="<"+t+e+">";return r+=o,"br"!==t&&(r+="</"+t+">"),r},e.html=function(t,e,o){var r=this.replacement;if("code"===t&&(o=r(o,"<","&lt;"),o=r(o,">","&gt;"),o=r(o," ","&nbsp;")),void 0===o)o=e,e="";if("object"===_typeof(o)&&void 0!==o[0]){var n="";o.forEach(function(t,e){n+=""+t});i=this.createTag(t,e,n)}else if("object"===_typeof(o))e=o,i=this.createTag(t,e,o="");else var i=this.createTag(t,e,o);return i},e.el=function(t,e,o){return this.html(t,e,o)},t}();
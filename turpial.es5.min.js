/*
 *	Turpial JS Templating Engine Library V. 1.0.0
 *	Copyright Yorman Maricuto, May 2019.  
 * 	License MIT.
 * 	Social Media/Contact:
 *	@twitter: @MaricutoYorman
 *	@Instagram: maricuto
 *	@email: yerikmiller@gmail.com
 *	@number: +584267886875
 *	@github: yerikmiller
 * 	@project: guide | github.
 *	Micro Framework to create web components and a templating engine for user interfaces (UI).
 *	Turpial: The Venezuela's national bird.
 *
 * 	MADE IN: V E N E Z U E L A.
 * 	@Development Version. V. 1.0.0
 *
*/
"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Turpial=function(){function e(){var l=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.birds=[],this.un=function(t){return void 0===t?1<arguments.length&&void 0!==arguments[1]?arguments[1]:"":t},this.searchStr=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=t.search(e);return-1!==r&&(!0!==n||r)},this.replacement=function(t,e,n){return t.split(e).join(n)},this.find=function(t){return"string"==typeof t?document.getElementById(t):t},this.autoloader=this.un(t.autoloader,!1),this.autoloader_folder=this.un(t.autoloader_folder,""),this.cache=this.un(t.cache,"default"),this.public_path=this.un(t.public_path,""),this.core_path=this.un(t.core_path,""),this.folder=this.un(t.core_path,"/turpial/"),this.loader={},this.loader.show=this.un(t.loaderShow,null),this.loader.hide=this.un(t.loaderHide,null),this.views={},this.resources={},this.Pro=function(e){return new Promise(function(t){e();setInterval(function(){console.log(e)},500)})},this.component={set:function(n){var r=n.tag,t=l.un(n.extends,null);void 0===window.customElements.get(r)&&(null!==t&&(t={extends:t}),window.customElements.define(r,function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.props;return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,function(e){function t(t){return _toConsumableArray(document.getElementsByTagName(t)).forEach(function(t){e(t)}),"ready"}if(window.addEventListener("load",function(){return t(r)}),"complete"===document.readyState)return t(r)}(t)))}return _inherits(e,_wrapNativeSuper(HTMLElement)),e}(),t))}},this.view={application:this},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(t){var e=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;document.head.appendChild(l.filesLoaded[a])}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}},this.models.fetch=function(u){var s=l.un(u.type,"script"),t=l.un(u.options,{cache:l.cache});if(void 0===u.ready&&(u.ready=function(){}),"string"==typeof u.file)var e=[u.file];else e=u.file;var f=l,p=(document.head,[]),h=[];u.getString=function(t){return t.clone().text()},u.fetching=function(n){void 0!==f.filesLoaded[n]&&"script"===s&&f.filesLoaded[n].remove(),window.fetch(n,t).then(function(t){if("function"==typeof u.error&&200!==t.status)return u.error(t.status);200===t.status&&u.getString(t).then(function(t){h.push(t);var e=document.createElement("script");e.text=t,f.filesLoaded[n]=e,p.push(n)})})},function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;u.fetching(a)}}catch(t){n=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}var c=0,l=setInterval(function(){var t=!1;if(1e4===(c+=70)&&(t=!0,console.warn("Â¡Impossible to load all files.")),p.length===e.length||!0===t){if(clearInterval(l),"script"===s)return f.inject(e),void u.ready();if("text"===s)return void u.ready(h)}},70)}(e)},this.fetch=function(t){return l.models.fetch(t)},this.include=function(t){return l.models.fetch(t)},this.controller.views={application:this,folder:"".concat(this.folder,"views/"),ext:".turpial.js",path:function(t){var e=this,n=t.views.split("/"),r=e.folder;if(1===n.length){var o=n[0];return r+="".concat(o).concat(e.ext),e.application.resources[o]={},r}var i=n.pop(),a=n.pop();o=i;return e.application.resources[a]={},e.application.resources[a][o]={},0===n.length||n.forEach(function(t){r+="".concat(t,"/")}),r+="".concat(a,"/").concat(o).concat(e.ext)}},this.view.load=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{folder:l.autoloader_folder,ready:function(){}},t=".turpial.js",n=l.app.parameters,r=l.app.controller_name,o=l.app.action_name,i="".concat(l.folder).concat(e.folder).concat(r);if("index"===r)var a="".concat(i).concat(t);else if(0===n.length&&"index"!==r&&void 0===o)a="".concat(i,"/index").concat(t);else if(0===n.length&&"undefined"!==o)a="".concat(i,"/").concat(o,"/index").concat(t);else{a="".concat(i,"/").concat(o);n.forEach(function(t){a+="/".concat(t)}),a+=t}var c={file:a,ready:function(){e.ready()}};"function"==typeof e.error&&(c.error=function(t){e.error(t)}),l.fetch(c),l.DataView=c},this.controller.routes={set:function(){var e=l;e.app={};var t=window.location.href.split("?"),n=(t=(t=t[0]).split("#"))[0].search(l.public_path);if(0<n){var r=(t=t[0].substr(n+l.public_path.length)).split("/"),o=0,i=0;e.app.parameters=[],r.forEach(function(t){""!=t&&(0===o&&(e.app.controller_name=t),1===o?e.app.action_name=t:1<o&&(e.app.parameters[i++]=t),o++)}),void 0===e.app.controller_name&&(e.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(t){var e=window.location.href,n=(e=(e=(e=(e=e.split("#"))[0]).split("?"))[0]).split("/");n=""===n.pop()?"":"/",!0===l.searchStr(t.path,"http")&&(e=""),window.history.pushState(l.un(t.object),"",l.un("".concat(e).concat(n).concat(t.path))),l.controller.routes.set(),l.urls.load();var r=l.un(t.title,!1);"string"==typeof r&&(document.title=r)},go:function(t){if("number"==typeof t)window.history.go(t);else if("back"===t)window.history.back();else{if("forward"!==t)return;window.history.forward()}l.controller.routes.set(),l.urls.load()}},this.router=function(t){"number"!=typeof t&&"string"!=typeof t?l.controller.routes.change(t):l.controller.routes.go(t)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(n){if("object"===_typeof(n)){"string"==typeof n.views&&(n.views=[n.views]);var r=[],o=l.controller.views;n.views.forEach(function(t,e){n.views=t,r[e]=o.path(n)}),l.fetch({file:r,ready:n.ready})}},this.urls={},this.urls.load=function(){var t=l.app.controller_name,e=l.app.action_name,n=l.app.parameters,r=l.un(l.urls[t],!1);if(!1!==r){l.un(r.loadController,!0);var o=l.un(r.loadAction,!0),i=l.un(r.loadParameters,1e3),a=l.un(l.urls[t][e],!1);return"function"==typeof r.self?"function"==typeof a&&!0===o?n.length>i?void r.self(function(){a(function(){})}):void r.self(function(){a(function(){l.view.load()})}):!1===o&&"string"==typeof e?void r.self(function(){a(function(){})}):void r.self(function(){l.view.load()}):void 0}l.view.load()},!0===t.autoloader&&(window.addEventListener("load",function(){l.urls.load()}),window.onpopstate=function(t){l.controller.routes.set(),l.urls.load()})}return _createClass(e,[{key:"map",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=this.birds[t];if("object"===_typeof(t)?r=t:void 0===r&&(r=this.find(t)),"object"===_typeof(n)){if(void 0===n[0])return r;r=r.children,n.forEach(function(t,e){r=void 0===n[e+1]?r[t]:r[t].children})}return r}},{key:"createMap",value:function(t){var e=(t=this.find(t)).getAttribute("id");if(void 0!==e){var n=document.getElementById(e);this.birds[e]=n}}},{key:"read",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:[];return this.map(t,n)}},{key:"selectorApp",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:[];return"object"===_typeof(n)&&!0===Number.isInteger(n[0])?this.map(t,n):n}},{key:"delete",value:function(t){(t=this.find(t)).remove()}},{key:"update",value:function(t,e,n,r){var o=1<arguments.length&&void 0!==e?e:null,i=2<arguments.length&&void 0!==n?n:"replace-selector",a=!(3<arguments.length&&void 0!==r)||r;if("string"==typeof o)var c=this.render(o),l=o;else c=o;if(null===c){var u=!1;c=o}else u=!0;var s=t;!0===a&&(i="replace-selector");var f=!1,p=s.parentNode;if("before"===i)p.insertBefore(c,s),f=c;else if("after"===i)p.insertBefore(c,s.nextSibling),f=c;else if("replace-selector"===i)p.replaceChild(c,s),f=c;else{if("inner"!==i)return console.warn("error-on-placement"),!1;!0===u?s.innerHTML=l:s.innerText=c,f=s}var h=s;return this.createMap(h),f}},{key:"insert",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:"inner";return t=this.find(t),this.update(t,e,r,!1)}},{key:"render",value:function(t){var e=document.createElement("template");return e.innerHTML=t,e=e.content.firstElementChild}},{key:"mount",value:function(t,e){if("string"==typeof e)e=this.render(e);if(null!==e){var n=(t=this.find(t)).appendChild(e),r=t;return this.createMap(r),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(t){if(void 0!==t[0])return"";var n=[],e=0;Object.values(t).forEach(function(t){n[e++]=t});var r=[];e=0;Object.keys(t).forEach(function(t){r[e++]=t});var o="";e=0;return r.forEach(function(t,e){o+=" ".concat(t,'="').concat(n[e],'"')}),o}},{key:"createTag",value:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:"",o=2<arguments.length&&void 0!==n?n:"";"object"===_typeof(r)&&(r=this.settings(r));var i="<".concat(t).concat(r,">");return i+=o,"br"!==t&&(i+="</".concat(t,">")),i}},{key:"html",value:function(t,e,n){"code"===t&&(n=this.replacement(n,"<","&lt;"),n=this.replacement(n,">","&gt;"),n=this.replacement(n," ","&nbsp;"));if(void 0===n)n=e,e="";if("object"===_typeof(n)&&void 0!==n[0]){var r="";n.forEach(function(t,e){r+="".concat(t)});o=this.createTag(t,e,r)}else if("object"===_typeof(n))e=n,o=this.createTag(t,e,n="");else var o=this.createTag(t,e,n);return o}},{key:"el",value:function(t,e,n){return this.html(t,e,n)}}]),e}();

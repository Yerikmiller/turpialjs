/*
  _______ _    _ _____  _____ _____          _             _  _____ 
 |__   __| |  | |  __ \|  __ \_   _|   /\   | |           | |/ ____|
    | |  | |  | | |__) | |__) || |    /  \  | |           | | (___  
    | |  | |  | |  _  /|  ___/ | |   / /\ \ | |       _   | |\___ \ 
    | |  | |__| | | \ \| |    _| |_ / ____ \| |____  | |__| |____) |
    |_|   \____/|_|  \_\_|   |_____/_/    \_\______|  \____/|_____/ 
    * Turpial JS Library V. 1.0.0
    * License: MIT.
    * Copyright Yorman Maricuto, May 2019.
    * @twitter: @MaricutoYorman, @Instagram: maricuto
    * Micro-Library to create web components, multi-fetch elements, append styles, scripts, templating engine JSX
*/
function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,o=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Turpial=function(){"use strict";function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.birds=[],this.un=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0===e?t:e},this.searchStr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.search(t);return-1!==o&&(!0!==n||o)},this.replacement=function(e,t,n){return e.split(t).join(n)},this.find=function(e){return"string"==typeof e?document.getElementById(e):e},this.ext=".turpial.js",this.allowStateEvents=this.un(n.allowStateEvents,!1),this.loadModulesOnRoute=this.un(n.loadModulesOnRoute,!0),this.autoloader=this.un(n.autoloader,!1),this.autoloader_folder=this.un(n.autoloader_folder,""),this.cache=this.un(n.cache,"public"),this.public_path=this.un(n.public_path,""),this.core_path=this.un(n.core_path,""),this.folder=this.un(n.core_path,"/turpial/"),this.loader={},this.httpRequests=[],this.loader.show=this.un(n.loaderShow,null),this.loader.hide=this.un(n.loaderHide,null),this.views={},this.statusResources="loaded",this.resources={},this.myComponents=[],this.random_string=function(e){void 0===e&&(e=6);for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*o));return t},this.selectData=function(e,t,n,o){o=turpial.un(o,!1);var r="";return e.forEach(function(e,i){if(e[t]==n)return!0===o?void(r=i):void(r=e)}),r},this.component={applyProps:function(e,n){var o=function(){var t=document.querySelectorAll(e);Array.prototype.slice.call(t).forEach(function(e){n(e)})},r=function(){if("loading"===t.statusResources)var e=0,n=setInterval(function(){return e>6e3?(console.warn("error loading resources and applying components"),void clearInterval(n)):(e+=20,"loaded"===t.statusResources?(clearInterval(n),void o()):void 0)},20);else o()};window.addEventListener("load",function(){r()}),"complete"!==document.readyState||r()},set:function(e){var n=t,o=n.component,r=e.props,i=e.tag;n.myComponents.push({tag:i,props:r});var a=n.un(e.extends,null);if(null!==a&&(a={extends:a}),void 0===window.customElements)return n.component.olderVerBrow=function(){},void o.applyProps(i,r);void 0===window.customElements.get(i)&&window.customElements.define(i,function(t){_inherits(r,_wrapNativeSuper(HTMLElement));var n=_createSuper(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props;return _classCallCheck(this,r),n.call(this,function(e){o.applyProps(i,e)}(t))}return r}(),a)}},this.view={},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(e){var n,o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){var r=n.value;"STYLE"===t.filesLoaded[r].tagName&&(t.filesLoaded[r].innerHTML=t.filesLoaded[r].text),document.head.appendChild(t.filesLoaded[r])}}catch(e){o.e(e)}finally{o.f()}},this.models.fetch=function(e){var n=t,o=e.type||"script",r=n.un(e.cancelOnResend,null),i=n.un(e.options,null),a=n.un(e.method,"GET");e.url=e.url||[],e.file=e.file||e.url,e.files=e.files||e.file;var c=e.files;void 0===e.ready&&(e.ready=function(){}),"string"==typeof c&&(c=[c]);document.head;var s=[],l=[],u=[];e.getString=function(e){return e.clone().text()},e.fetching=function(t){void 0!==n.filesLoaded[t]&&"script"===o&&n.filesLoaded[t].remove();var c=new XMLHttpRequest;c.open(a,t,!0);var f=[],p=[];if(null!==i){for(var d in i)p.push(i[d]);Object.keys(i).forEach(function(e,t){f.push([e,p[t]])}),f.forEach(function(e){c.setRequestHeader(e[0],e[1])})}if(c.onload=function(){if(c.status>=200&&c.status<400){var r,i=c.responseText;u.push(i),r="script"===o||"style"===o||"link"===o?o:"script";var a=document.createElement(r);"style"===o?a.type="text/css":"link"===o&&(a.rel="stylesheet",a.media="all",a.href=t),a.text=i,n.filesLoaded[t]=a,s.push(t)}else if("function"==typeof e.onerror&&c.status>=400)return e.onerror(c.status)},c.onerror=function(){n.filesLoaded[t]="",s.push("unloaded:"+t),l.push(t)},!0===r){var h="rq_"+n.un(e.id,n.random_string(4));if(void 0!==n.httpRequests[h])try{n.httpRequests[h].abort()}catch(e){console.warn("unable to cancel request.")}n.httpRequests[h]=c}"POST"!==a?c.send():c.send(e.data)},n.statusResources="loading",function(t){var r,i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.fetching(a)}}catch(e){i.e(e)}finally{i.f()}var c=0,l=setInterval(function(){var r=!1;if(1e4===(c+=70)&&(r=!0,console.warn("Â¡Impossible to load all files.")),s.length!==t.length&&!0!==r);else{if(clearInterval(l),"script"===o||"style"===o||"link"===o)n.inject(t),e.ready();else if("text"===o){var i,a=[],u=_createForOfIteratorHelper(t);try{for(u.s();!(i=u.n()).done;){var f=i.value;a.push(n.filesLoaded[f].innerHTML)}}catch(e){u.e(e)}finally{u.f()}e.ready(a)}n.statusResources="loaded"}},70)}(c)},this.fetch=function(e){return t.models.fetch(e)},this.include=function(e){return t.models.fetch(e)},this.linkCSS=function(e){e.type="link";var n=t;e.type="style",e.url=e.url||[],e.file=e.file||e.url,e.files=e.files||e.file;var o=[];return e.files.map(function(e){var t=document.createElement("link");t.setAttribute("media","all"),t.setAttribute("rel","stylesheet"),t.href=e;var r=n.mount(document.head,t);o.push(r)}),e.ready(o),o},this.includeCSS=function(e){return e.type="style",t.models.fetch(e)},this.controller.views={path:function(e){var n=t.ext,o="".concat(t.folder,"views/"),r=e.views,i=t.resources,a=r.split("/"),c=o;if(1===a.length){var s=a[0];return c+="".concat(s).concat(n),i[s]={},c}var l=a.pop(),u=a.pop();s=l;return i[u]={},i[u][s]={},0===a.length?c+="".concat(u,"/").concat(s).concat(n):(a.forEach(function(e){c+="".concat(e,"/")}),c+="".concat(u,"/").concat(s).concat(n)),c}},this.view.load=function(e){(e=e||{}).ready=e.ready||function(){},e.folder=t.autoloader_folder||"";var n=t.ext,o=t.app.parameters,r=t.app.controller_name,i=t.app.action_name,a="".concat(t.folder).concat(e.folder).concat(r);if(e.module=turpial.un(e.module,null),"index"===r)var c="".concat(a).concat(n);else if(0===o.length&&"index"!==r&&void 0===i)c="".concat(a,"/index").concat(n);else if(0===o.length&&"undefined"!==i)c="".concat(a,"/").concat(i,"/index").concat(n);else{c="".concat(a,"/").concat(i);o.forEach(function(e){c+="/".concat(e)}),c+=n}"string"==typeof e.module&&(e.ext=e.ext||n,c=t.core_path+e.module+e.ext);var s={file:c,options:e.options||{},ready:function(){e.ready()}};"function"==typeof e.error&&(s.error=function(t){e.error(t)}),t.DataView=s,""!==e.module&&!1!==e.module&&t.fetch(s)},this.controller.routes={getHost:function(e){var n=t;!1!==(e=e||{}).loadModule&&!1!==n.loadModulesOnRoute||(e.relativeModules=!0);var o=window.location.href;o=(o=(o=(o=o.split("#"))[0]).split("?"))[0];var r=n.un(e.relativeModules,!1),i=o.search(n.public_path),a=o.slice(i,i+n.public_path.length),c=(a=o.split(a)[0]+a).slice(-1);return c="/"!==c?"/":"",1==r?"".concat(a).concat(c):(c="/"!==(c=o.slice(-1))?"/":"","".concat(o).concat(c))},set:function(){var e=t;e.app={};var n=window.location.href.split("?"),o=(n=(n=n[0]).split("#"))[0].search(e.public_path);if(o>0){var r=(n=n[0].substr(o+e.public_path.length)).split("/"),i=0,a=0;e.app.parameters=[],r.forEach(function(t){""!=t&&(0===i&&(e.app.controller_name=t),1===i?e.app.action_name=t:i>1&&(e.app.parameters[a++]=t),i++)}),void 0===e.app.controller_name&&(e.app.controller_name="index"),e.host=e.controller.routes.getHost()}else console.warn("bad_public_path_name")},change:function(e){var n=t;e.loadModule=n.un(e.loadModule,!0);var o="".concat(n.controller.routes.getHost(e)).concat(e.path);if(o!==window.location.href){window.history.pushState(n.un(e.object),"",n.un(o)),!0===e.loadModule&&!0===n.loadModulesOnRoute&&n.urls.load(e);var r=n.un(e.title,!1);"string"==typeof r&&(document.title=r)}},go:function(e){if("number"==typeof e)window.history.go(e);else if("back"===e)window.history.back();else{if("forward"!==e)return;window.history.forward()}t.controller.routes.set(),t.urls.load()}},this.router=function(e,n){n=n||function(){},"number"!=typeof e&&"string"!=typeof e?(t.controller.routes.change(e),t.stateEvent(),n()):t.controller.routes.go(e)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(e){if("object"===_typeof(e)){"string"==typeof e.views&&(e.views=[e.views]);var n=[],o=t.controller.views;e.views.forEach(function(t,r){e.views=t,n[r]=o.path(e)}),Object.assign(e,{file:n,ready:e.ready}),t.fetch(e)}},this.urls={},this.urls.load=function(e){e=e||{};var n=t,o=n.app.controller_name,r=n.app.action_name,i=n.app.parameters,a=n.urls[o]||!1;if(e.module=turpial.un(e.module,null),"string"!=typeof e.module){if(!1!==a){n.un(a.loadController,!0);var c=n.un(a.loadAction,!0),s=n.un(a.loadParameters,1e3),l=n.un(n.urls[o][r],!1);return"function"==typeof a.self?"function"==typeof l&&!0===c?i.length>s?void a.self(function(){l(function(){})}):void a.self(function(){l(function(){n.view.load(e)})}):!1===c&&"string"==typeof r?void a.self(function(){l(function(){})}):void a.self(function(){n.view.load(e)}):void 0}n.view.load(e)}else n.view.load(e)},this.historyEvents={},this.URLNoHASH=function(e){return e.split("#")[0]},this.createHistoryEvent=function(e,t){e=this.URLNoHASH(window.location.href)+(e=e||""),this.historyEvents[e]=t},this.createHistoryEvent("",function(){}),this.stateEvent=function(){var e=t.historyEvents;"function"==typeof e[t.URLNoHASH(window.location.href)]&&e[t.URLNoHASH(window.location.href)]()},!0===this.allowStateEvents&&window.addEventListener("popstate",this.stateEvent),!0===n.autoloader&&(window.addEventListener("load",function(){t.urls.load()}),window.onpopstate=function(e){t.controller.routes.set(),t.urls.load(),function(){void 0===window.customElements&&Array.prototype.slice.call(this.myComponents).forEach(function(e){this.component.set({tag:e.tag,props:e.props})})}()}),this.template=function(e,t){return function(e,t){if("object"===_typeof(t=t||[])&&!Array.isArray(t)){var n=[];Object.values(t).map(function(e,o){n.push(_defineProperty({},Object.keys(t)[o],e))}),t=n}"object"===_typeof(e)&&(e=e.innerHTML);var o=e;return t.forEach(function(t){var n=Object.keys(t),r=Object.values(t);n.forEach(function(t,n){var i,a,c;t="{{ ".concat(t," }}"),e.search(t)>=0&&(i=o,a=t,c=r[n],o=i.split(a).join(c))})}),o}(e,t)}}return _createClass(e,[{key:"map",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.birds[e];if("object"===_typeof(e)?n=e:void 0===n&&(n=this.find(e)),"object"===_typeof(t)){if(void 0===t[0])return n;n=n.children,t.forEach(function(e,o){n=void 0===t[o+1]?n[e]:n[e].children})}return n}},{key:"createMap",value:function(e){var t=(e=this.find(e)).getAttribute("id");if(void 0!==t){var n=document.getElementById(t);this.birds[t]=n}}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.map(e,t)}},{key:"selectorApp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"object"===_typeof(t)&&!0===Number.isInteger(t[0])?this.map(e,t):t}},{key:"delete",value:function(e){(e=this.find(e)).remove()}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace-selector",o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"==typeof t)var r=this.render(t),i=t;else r=t;if(null===r){var a=!1;r=t}else a=!0;var c=e;!0===o&&(n="replace-selector");var s=!1,l=c.parentNode;if("before"===n)l.insertBefore(r,c),s=r;else if("after"===n)l.insertBefore(r,c.nextSibling),s=r;else if("replace-selector"===n)l.replaceChild(r,c),s=r;else{if("inner"!==n)return console.warn("error-on-placement"),!1;!0===a?c.innerHTML=i:c.innerText=r,s=c}var u=c;return this.createMap(u),s}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner";return e=this.find(e),this.update(e,t,n,!1)}},{key:"render",value:function(e){var t=document.createElement("template");return t.innerHTML=e,t=t.content.firstElementChild}},{key:"mount",value:function(e,t){if("string"==typeof t)t=this.render(t);if(null!==t){var n=(e=this.find(e)).appendChild(t),o=e;return this.createMap(o),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(e){if(void 0===e[0]){var t=[],n=0,o=[];for(var r in e)o.push(e[r]);o.forEach(function(e){t[n++]=e});var i=[];n=0;Object.keys(e).forEach(function(e){i[n++]=e});var a="";n=0;return i.forEach(function(e,n){a+=" ".concat(e,'="').concat(t[n],'"')}),a}}},{key:"createTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"object"===_typeof(t)&&(t=this.settings(t));var o="<".concat(e).concat(t,">");return o+=n,"br"!==e&&(o+="</".concat(e,">")),o}},{key:"html",value:function(e,t,n){var o=this.replacement;if("code"===e&&(n=o(n,"<","&lt;"),n=o(n,">","&gt;"),n=o(n," ","&nbsp;")),void 0===n)n=t,t="";if("object"===_typeof(n)&&void 0!==n[0]){var r="";n.forEach(function(e,t){r+="".concat(e)});i=this.createTag(e,t,r)}else if("object"===_typeof(n))t=n,i=this.createTag(e,t,n="");else var i=this.createTag(e,t,n);return i}},{key:"el",value:function(e,t,n){return this.html(e,t,n)}}]),e}();
/*
 *  Turpial JS Library V. 1.0.0
 *  Copyright Yorman Maricuto, May 2019.  
 *  License MIT.
 *  Social Media/Contact:
 *  @twitter: @MaricutoYorman
 *  @Instagram: maricuto
 *  @email: yerikmiller@gmail.com
 *  @number: +584267886875
 *  @github: yerikmiller
 *  @project: guide | github.
 *  Micro Library to create web components with a simple template engine for user interfaces (UI).
 *  Easy XHR connections (POST & GET), inject Scripts and CSS whenever you want and make XHR requests.
 *  Turpial: The Venezuela's national bird.
 *
 *  MADE IN: V E N E Z U E L A.
 *
*/
"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _createSuper(e){return function(){var t,n=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Turpial=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.birds=[],this.un=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0===e?t:e},this.searchStr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.search(t);return-1!==r&&(!0!==n||r)},this.replacement=function(e,t,n){return e.split(t).join(n)},this.find=function(e){return"string"==typeof e?document.getElementById(e):e},this.ext=".turpial.js",this.autoloader=this.un(n.autoloader,!1),this.autoloader_folder=this.un(n.autoloader_folder,""),this.cache=this.un(n.cache,"public"),this.public_path=this.un(n.public_path,""),this.core_path=this.un(n.core_path,""),this.folder=this.un(n.core_path,"/turpial/"),this.loader={},this.loader.show=this.un(n.loaderShow,null),this.loader.hide=this.un(n.loaderHide,null),this.views={},this.statusResources="loaded",this.resources={},this.myComponents=[],this.component={applyProps:function(e,n){var r=function(){var t=document.querySelectorAll(e);Array.prototype.slice.call(t).forEach(function(e){n(e)})},o=function(){if("loading"===t.statusResources)var e=0,n=setInterval(function(){return e>6e3?(console.warn("error loading resources and applying components"),void clearInterval(n)):(e+=20,"loaded"===t.statusResources?(clearInterval(n),void r()):void 0)},20);else r()};window.addEventListener("load",function(){o()}),"complete"!==document.readyState||o()},set:function(e){var n=t,r=n.component,o=e.props,i=e.tag;n.myComponents.push({tag:i,props:o});var a=n.un(e.extends,null);if(null!==a&&(a={extends:a}),void 0===window.customElements)return n.component.olderVerBrow=function(){},void r.applyProps(i,o);void 0===window.customElements.get(i)&&window.customElements.define(i,function(t){_inherits(o,_wrapNativeSuper(HTMLElement));var n=_createSuper(o);function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props;return _classCallCheck(this,o),n.call(this,function(e){r.applyProps(i,e)}(t))}return o}(),a)}},this.view={},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(e){var n,r=_createForOfIteratorHelper(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;"STYLE"===t.filesLoaded[o].tagName&&(t.filesLoaded[o].innerHTML=t.filesLoaded[o].text),document.head.appendChild(t.filesLoaded[o])}}catch(e){r.e(e)}finally{r.f()}},this.models.fetch=function(e){var n=t,r=e.type||"script",o=n.un(e.options,null),i=n.un(e.method,"GET");e.url=e.url||[],e.file=e.file||e.url,e.files=e.files||e.file;var a=e.files;void 0===e.ready&&(e.ready=function(){}),"string"==typeof a&&(a=[a]);document.head;var c=[],s=[];e.getString=function(e){return e.clone().text()},e.fetching=function(t){void 0!==n.filesLoaded[t]&&"script"===r&&n.filesLoaded[t].remove();var a=new XMLHttpRequest;a.open(i,t,!0);var l=[],u=[];if(null!==o){for(var f in o)u.push(o[f]);Object.keys(o).forEach(function(e,t){l.push([e,u[t]])}),l.forEach(function(e){a.setRequestHeader(e[0],e[1])})}a.onload=function(){if(a.status>=200&&a.status<400){var o,i=a.responseText;s.push(i),o="script"===r||"style"===r||"link"===r?r:"script";var l=document.createElement(o);"style"===r?l.type="text/css":"link"===r&&(l.rel="stylesheet",l.media="all",l.href=t),l.text=i,n.filesLoaded[t]=l,c.push(t)}else if("function"==typeof e.onerror&&a.status>=400)return e.onerror(a.status)},"POST"!==i?a.send():a.send(e.data)},n.statusResources="loading",function(t){var o,i=_createForOfIteratorHelper(t);try{for(i.s();!(o=i.n()).done;){var a=o.value;e.fetching(a)}}catch(e){i.e(e)}finally{i.f()}var s=0,l=setInterval(function(){var o=!1;if(1e4===(s+=70)&&(o=!0,console.warn("Â¡Impossible to load all files.")),c.length!==t.length&&!0!==o);else{if(clearInterval(l),"script"===r||"style"===r||"link"===r)n.inject(t),e.ready();else if("text"===r){var i,a=[],u=_createForOfIteratorHelper(t);try{for(u.s();!(i=u.n()).done;){var f=i.value;a.push(n.filesLoaded[f].innerHTML)}}catch(e){u.e(e)}finally{u.f()}e.ready(a)}n.statusResources="loaded"}},70)}(a)},this.fetch=function(e){return t.models.fetch(e)},this.include=function(e){return t.models.fetch(e)},this.linkCSS=function(e){return e.type="link",t.models.fetch(e)},this.includeCSS=function(e){return e.type="style",t.models.fetch(e)},this.controller.views={path:function(e){var n=t.ext,r="".concat(t.folder,"views/"),o=e.views,i=t.resources,a=o.split("/"),c=r;if(1===a.length){var s=a[0];return c+="".concat(s).concat(n),i[s]={},c}var l=a.pop(),u=a.pop();s=l;return i[u]={},i[u][s]={},0===a.length?c+="".concat(u,"/").concat(s).concat(n):(a.forEach(function(e){c+="".concat(e,"/")}),c+="".concat(u,"/").concat(s).concat(n)),c}},this.view.load=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{folder:t.autoloader_folder,ready:function(){}},n=t.ext,r=t.app.parameters,o=t.app.controller_name,i=t.app.action_name,a="".concat(t.folder).concat(e.folder).concat(o);if("index"===o)var c="".concat(a).concat(n);else if(0===r.length&&"index"!==o&&void 0===i)c="".concat(a,"/index").concat(n);else if(0===r.length&&"undefined"!==i)c="".concat(a,"/").concat(i,"/index").concat(n);else{c="".concat(a,"/").concat(i);r.forEach(function(e){c+="/".concat(e)}),c+=n}var s={file:c,ready:function(){e.ready()}};"function"==typeof e.error&&(s.error=function(t){e.error(t)}),t.fetch(s),t.DataView=s},this.controller.routes={set:function(){var e=t;e.app={};var n=window.location.href.split("?"),r=(n=(n=n[0]).split("#"))[0].search(e.public_path);if(r>0){var o=(n=n[0].substr(r+e.public_path.length)).split("/"),i=0,a=0;e.app.parameters=[],o.forEach(function(t){""!=t&&(0===i&&(e.app.controller_name=t),1===i?e.app.action_name=t:i>1&&(e.app.parameters[a++]=t),i++)}),void 0===e.app.controller_name&&(e.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(e){var n=t,r=window.location.href,o=(r=(r=(r=(r=r.split("#"))[0]).split("?"))[0]).split("/");o=""===o.pop()?"":"/",!0===n.searchStr(e.path,"http")&&(r=""),window.history.pushState(n.un(e.object),"",n.un("".concat(r).concat(o).concat(e.path))),n.controller.routes.set(),n.urls.load();var i=n.un(e.title,!1);"string"==typeof i&&(document.title=i)},go:function(e){if("number"==typeof e)window.history.go(e);else if("back"===e)window.history.back();else{if("forward"!==e)return;window.history.forward()}t.controller.routes.set(),t.urls.load()}},this.router=function(e){"number"!=typeof e&&"string"!=typeof e?t.controller.routes.change(e):t.controller.routes.go(e)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(e){if("object"===_typeof(e)){"string"==typeof e.views&&(e.views=[e.views]);var n=[],r=t.controller.views;e.views.forEach(function(t,o){e.views=t,n[o]=r.path(e)}),Object.assign(e,{file:n,ready:e.ready}),t.fetch(e)}},this.urls={},this.urls.load=function(){var e=t,n=e.app.controller_name,r=e.app.action_name,o=e.app.parameters,i=e.un(e.urls[n],!1);if(!1!==i){e.un(i.loadController,!0);var a=e.un(i.loadAction,!0),c=e.un(i.loadParameters,1e3),s=e.un(e.urls[n][r],!1);return"function"==typeof i.self?"function"==typeof s&&!0===a?o.length>c?void i.self(function(){s(function(){})}):void i.self(function(){s(function(){e.view.load()})}):!1===a&&"string"==typeof r?void i.self(function(){s(function(){})}):void i.self(function(){e.view.load()}):void 0}e.view.load()},!0===n.autoloader&&(window.addEventListener("load",function(){t.urls.load()}),window.onpopstate=function(e){t.controller.routes.set(),t.urls.load(),function(){void 0===window.customElements&&Array.prototype.slice.call(this.myComponents).forEach(function(e){this.component.set({tag:e.tag,props:e.props})})}()})}return _createClass(e,[{key:"map",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.birds[e];if("object"===_typeof(e)?n=e:void 0===n&&(n=this.find(e)),"object"===_typeof(t)){if(void 0===t[0])return n;n=n.children,t.forEach(function(e,r){n=void 0===t[r+1]?n[e]:n[e].children})}return n}},{key:"createMap",value:function(e){var t=(e=this.find(e)).getAttribute("id");if(void 0!==t){var n=document.getElementById(t);this.birds[t]=n}}},{key:"read",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.map(e,t)}},{key:"selectorApp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"object"===_typeof(t)&&!0===Number.isInteger(t[0])?this.map(e,t):t}},{key:"delete",value:function(e){(e=this.find(e)).remove()}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace-selector",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"==typeof t)var o=this.render(t),i=t;else o=t;if(null===o){var a=!1;o=t}else a=!0;var c=e;!0===r&&(n="replace-selector");var s=!1,l=c.parentNode;if("before"===n)l.insertBefore(o,c),s=o;else if("after"===n)l.insertBefore(o,c.nextSibling),s=o;else if("replace-selector"===n)l.replaceChild(o,c),s=o;else{if("inner"!==n)return console.warn("error-on-placement"),!1;!0===a?c.innerHTML=i:c.innerText=o,s=c}var u=c;return this.createMap(u),s}},{key:"insert",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner";return e=this.find(e),this.update(e,t,n,!1)}},{key:"render",value:function(e){var t=document.createElement("template");return t.innerHTML=e,t=t.content.firstElementChild}},{key:"mount",value:function(e,t){if("string"==typeof t)t=this.render(t);if(null!==t){var n=(e=this.find(e)).appendChild(t),r=e;return this.createMap(r),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(e){if(void 0===e[0]){var t=[],n=0,r=[];for(var o in e)r.push(e[o]);r.forEach(function(e){t[n++]=e});var i=[];n=0;Object.keys(e).forEach(function(e){i[n++]=e});var a="";n=0;return i.forEach(function(e,n){a+=" ".concat(e,'="').concat(t[n],'"')}),a}}},{key:"createTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"object"===_typeof(t)&&(t=this.settings(t));var r="<".concat(e).concat(t,">");return r+=n,"br"!==e&&(r+="</".concat(e,">")),r}},{key:"html",value:function(e,t,n){var r=this.replacement;if("code"===e&&(n=r(n,"<","&lt;"),n=r(n,">","&gt;"),n=r(n," ","&nbsp;")),void 0===n)n=t,t="";if("object"===_typeof(n)&&void 0!==n[0]){var o="";n.forEach(function(e,t){o+="".concat(e)});i=this.createTag(e,t,o)}else if("object"===_typeof(n))t=n,i=this.createTag(e,t,n="");else var i=this.createTag(e,t,n);return i}},{key:"el",value:function(e,t,n){return this.html(e,t,n)}}]),e}();
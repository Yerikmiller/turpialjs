/*
  _______ _    _ _____  _____ _____          _             _  _____ 
 |__   __| |  | |  __ \|  __ \_   _|   /\   | |           | |/ ____|
    | |  | |  | | |__) | |__) || |    /  \  | |           | | (___  
    | |  | |  | |  _  /|  ___/ | |   / /\ \ | |       _   | |\___ \ 
    | |  | |__| | | \ \| |    _| |_ / ____ \| |____  | |__| |____) |
    |_|   \____/|_|  \_\_|   |_____/_/    \_\______|  \____/|_____/ 
    * Turpial JS Library V. 1.0.0
    * License: MIT.
    * Copyright Yorman Maricuto, May 2019.
    * @twitter: @MaricutoYorman, @Instagram: maricuto
    * Micro-Library to create web components, multi-fetch elements, append styles, scripts, templating engine JSX
*/
"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(t);if(e){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Turpial=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.birds=[],this.un=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return void 0===t?e:t},this.searchStr=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.search(e);return-1!==r&&(!0!==n||r)},this.replacement=function(t,e,n){return t.split(e).join(n)},this.find=function(t){return"string"==typeof t?document.getElementById(t):t},this.ext=".turpial.js",this.allowStateEvents=this.un(n.allowStateEvents,!1),this.autoloader=this.un(n.autoloader,!1),this.autoloader_folder=this.un(n.autoloader_folder,""),this.cache=this.un(n.cache,"public"),this.public_path=this.un(n.public_path,""),this.core_path=this.un(n.core_path,""),this.folder=this.un(n.core_path,"/turpial/"),this.loader={},this.httpRequests=[],this.loader.show=this.un(n.loaderShow,null),this.loader.hide=this.un(n.loaderHide,null),this.views={},this.statusResources="loaded",this.resources={},this.myComponents=[],this.random_string=function(t){void 0===t&&(t=6);for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*r));return e},this.selectData=function(t,e,n,r){r=turpial.un(r,!1);var o="";return t.forEach(function(t,i){if(t[e]==n)return!0===r?void(o=i):void(o=t)}),o},this.component={applyProps:function(t,n){var r=function(){var e=document.querySelectorAll(t);Array.prototype.slice.call(e).forEach(function(t){n(t)})},o=function(){if("loading"===e.statusResources)var t=0,n=setInterval(function(){return t>6e3?(console.warn("error loading resources and applying components"),void clearInterval(n)):(t+=20,"loaded"===e.statusResources?(clearInterval(n),void r()):void 0)},20);else r()};window.addEventListener("load",function(){o()}),"complete"!==document.readyState||o()},set:function(t){var n=e,r=n.component,o=t.props,i=t.tag;n.myComponents.push({tag:i,props:o});var a=n.un(t.extends,null);if(null!==a&&(a={extends:a}),void 0===window.customElements)return n.component.olderVerBrow=function(){},void r.applyProps(i,o);void 0===window.customElements.get(i)&&window.customElements.define(i,function(e){_inherits(o,_wrapNativeSuper(HTMLElement));var n=_createSuper(o);function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props;return _classCallCheck(this,o),n.call(this,function(t){r.applyProps(i,t)}(e))}return o}(),a)}},this.view={},this.models={},this.models.sources={},this.controller={},this.urls={},this.filesLoaded={},this.inject=function(t){var n,r=_createForOfIteratorHelper(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;"STYLE"===e.filesLoaded[o].tagName&&(e.filesLoaded[o].innerHTML=e.filesLoaded[o].text),document.head.appendChild(e.filesLoaded[o])}}catch(t){r.e(t)}finally{r.f()}},this.models.fetch=function(t){var n=e,r=t.type||"script",o=n.un(t.cancelOnResend,null),i=n.un(t.options,null),a=n.un(t.method,"GET");t.url=t.url||[],t.file=t.file||t.url,t.files=t.files||t.file;var c=t.files;void 0===t.ready&&(t.ready=function(){}),"string"==typeof c&&(c=[c]);document.head;var s=[],l=[],u=[];t.getString=function(t){return t.clone().text()},t.fetching=function(e){void 0!==n.filesLoaded[e]&&"script"===r&&n.filesLoaded[e].remove();var c=new XMLHttpRequest;c.open(a,e,!0);var f=[],p=[];if(null!==i){for(var d in i)p.push(i[d]);Object.keys(i).forEach(function(t,e){f.push([t,p[e]])}),f.forEach(function(t){c.setRequestHeader(t[0],t[1])})}if(c.onload=function(){if(c.status>=200&&c.status<400){var o,i=c.responseText;u.push(i),o="script"===r||"style"===r||"link"===r?r:"script";var a=document.createElement(o);"style"===r?a.type="text/css":"link"===r&&(a.rel="stylesheet",a.media="all",a.href=e),a.text=i,n.filesLoaded[e]=a,s.push(e)}else if("function"==typeof t.onerror&&c.status>=400)return t.onerror(c.status)},c.onerror=function(){n.filesLoaded[e]="",s.push("unloaded:"+e),l.push(e)},!0===o){var h="rq_"+n.un(t.id,n.random_string(4));if(void 0!==n.httpRequests[h])try{n.httpRequests[h].abort()}catch(t){console.warn("unable to cancel request.")}n.httpRequests[h]=c}"POST"!==a?c.send():c.send(t.data)},n.statusResources="loading",function(e){var o,i=_createForOfIteratorHelper(e);try{for(i.s();!(o=i.n()).done;){var a=o.value;t.fetching(a)}}catch(t){i.e(t)}finally{i.f()}var c=0,l=setInterval(function(){var o=!1;if(1e4===(c+=70)&&(o=!0,console.warn("Â¡Impossible to load all files.")),s.length!==e.length&&!0!==o);else{if(clearInterval(l),"script"===r||"style"===r||"link"===r)n.inject(e),t.ready();else if("text"===r){var i,a=[],u=_createForOfIteratorHelper(e);try{for(u.s();!(i=u.n()).done;){var f=i.value;a.push(n.filesLoaded[f].innerHTML)}}catch(t){u.e(t)}finally{u.f()}t.ready(a)}n.statusResources="loaded"}},70)}(c)},this.fetch=function(t){return e.models.fetch(t)},this.include=function(t){return e.models.fetch(t)},this.linkCSS=function(t){t.type="link";var n=e;t.type="style",t.url=t.url||[],t.file=t.file||t.url,t.files=t.files||t.file;var r=[];return t.files.map(function(t){var e=document.createElement("link");e.setAttribute("media","all"),e.href=t;var o=n.mount(document.head,e);r.push(o)}),t.ready(r),r},this.includeCSS=function(t){return t.type="style",e.models.fetch(t)},this.controller.views={path:function(t){var n=e.ext,r="".concat(e.folder,"views/"),o=t.views,i=e.resources,a=o.split("/"),c=r;if(1===a.length){var s=a[0];return c+="".concat(s).concat(n),i[s]={},c}var l=a.pop(),u=a.pop();s=l;return i[u]={},i[u][s]={},0===a.length?c+="".concat(u,"/").concat(s).concat(n):(a.forEach(function(t){c+="".concat(t,"/")}),c+="".concat(u,"/").concat(s).concat(n)),c}},this.view.load=function(t){t=t||{folder:e.autoloader_folder,ready:function(){}};var n=e.ext,r=e.app.parameters,o=e.app.controller_name,i=e.app.action_name,a="".concat(e.folder).concat(t.folder).concat(o);if(t.module=turpial.un(t.module,null),"index"===o)var c="".concat(a).concat(n);else if(0===r.length&&"index"!==o&&void 0===i)c="".concat(a,"/index").concat(n);else if(0===r.length&&"undefined"!==i)c="".concat(a,"/").concat(i,"/index").concat(n);else{c="".concat(a,"/").concat(i);r.forEach(function(t){c+="/".concat(t)}),c+=n}"string"==typeof t.module&&(t.ext=t.ext||n,c=e.core_path+t.module+t.ext);var s={file:c,options:t.options||{},ready:function(){t.ready()}};"function"==typeof t.error&&(s.error=function(e){t.error(e)}),e.DataView=s,""!==t.module&&!1!==t.module&&e.fetch(s)},this.controller.routes={set:function(){var t=e;t.app={};var n=window.location.href.split("?"),r=(n=(n=n[0]).split("#"))[0].search(t.public_path);if(r>0){var o=(n=n[0].substr(r+t.public_path.length)).split("/"),i=0,a=0;t.app.parameters=[],o.forEach(function(e){""!=e&&(0===i&&(t.app.controller_name=e),1===i?t.app.action_name=e:i>1&&(t.app.parameters[a++]=e),i++)}),void 0===t.app.controller_name&&(t.app.controller_name="index")}else console.warn("bad_public_path_name")},change:function(t){var n=e,r=window.location.href,o=(r=(r=(r=(r=r.split("#"))[0]).split("?"))[0]).split("/");o=""===o.pop()?"":"/",!0===n.searchStr(t.path,"http")&&(r=""),window.history.pushState(n.un(t.object),"",n.un("".concat(r).concat(o).concat(t.path))),n.controller.routes.set(),n.urls.load(t);var i=n.un(t.title,!1);"string"==typeof i&&(document.title=i)},go:function(t){if("number"==typeof t)window.history.go(t);else if("back"===t)window.history.back();else{if("forward"!==t)return;window.history.forward()}e.controller.routes.set(),e.urls.load()}},this.router=function(t){"number"!=typeof t&&"string"!=typeof t?(e.controller.routes.change(t),e.stateEvent()):e.controller.routes.go(t)},this.routes=this.controller.routes.set,this.routes(),this.controller.components={},this.views.get=function(t){if("object"===_typeof(t)){"string"==typeof t.views&&(t.views=[t.views]);var n=[],r=e.controller.views;t.views.forEach(function(e,o){t.views=e,n[o]=r.path(t)}),Object.assign(t,{file:n,ready:t.ready}),e.fetch(t)}},this.urls={},this.urls.load=function(t){t=t||{};var n=e,r=n.app.controller_name,o=n.app.action_name,i=n.app.parameters,a=n.urls[r]||!1;if(t.module=turpial.un(t.module,null),"string"!=typeof t.module){if(!1!==a){n.un(a.loadController,!0);var c=n.un(a.loadAction,!0),s=n.un(a.loadParameters,1e3),l=n.un(n.urls[r][o],!1);return"function"==typeof a.self?"function"==typeof l&&!0===c?i.length>s?void a.self(function(){l(function(){})}):void a.self(function(){l(function(){n.view.load(t)})}):!1===c&&"string"==typeof o?void a.self(function(){l(function(){})}):void a.self(function(){n.view.load(t)}):void 0}n.view.load(t)}else n.view.load(t)},this.historyEvents={},this.URLNoHASH=function(t){return t.split("#")[0]},this.createHistoryEvent=function(t,e){t=this.URLNoHASH(window.location.href)+(t=t||""),this.historyEvents[t]=e},this.createHistoryEvent("",function(){}),this.stateEvent=function(){var t=e.historyEvents;"function"==typeof t[e.URLNoHASH(window.location.href)]&&t[e.URLNoHASH(window.location.href)]()},!0===this.allowStateEvents&&window.addEventListener("popstate",this.stateEvent),!0===n.autoloader&&(window.addEventListener("load",function(){e.urls.load()}),window.onpopstate=function(t){e.controller.routes.set(),e.urls.load(),function(){void 0===window.customElements&&Array.prototype.slice.call(this.myComponents).forEach(function(t){this.component.set({tag:t.tag,props:t.props})})}()}),this.template=function(t,e){return function(t,e){if("object"===_typeof(e=e||[])&&!Array.isArray(e)){var n=[];Object.values(e).map(function(t,r){n.push(_defineProperty({},Object.keys(e)[r],t))}),e=n}"object"===_typeof(t)&&(t=t.innerHTML);var r=t;return e.forEach(function(e){var n=Object.keys(e),o=Object.values(e);n.forEach(function(e,n){var i,a,c;e="{{ ".concat(e," }}"),t.search(e)>=0&&(i=r,a=e,c=o[n],r=i.split(a).join(c))})}),r}(t,e)}}return _createClass(t,[{key:"map",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.birds[t];if("object"===_typeof(t)?n=t:void 0===n&&(n=this.find(t)),"object"===_typeof(e)){if(void 0===e[0])return n;n=n.children,e.forEach(function(t,r){n=void 0===e[r+1]?n[t]:n[t].children})}return n}},{key:"createMap",value:function(t){var e=(t=this.find(t)).getAttribute("id");if(void 0!==e){var n=document.getElementById(e);this.birds[e]=n}}},{key:"read",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.map(t,e)}},{key:"selectorApp",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return"object"===_typeof(e)&&!0===Number.isInteger(e[0])?this.map(t,e):e}},{key:"delete",value:function(t){(t=this.find(t)).remove()}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace-selector",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"==typeof e)var o=this.render(e),i=e;else o=e;if(null===o){var a=!1;o=e}else a=!0;var c=t;!0===r&&(n="replace-selector");var s=!1,l=c.parentNode;if("before"===n)l.insertBefore(o,c),s=o;else if("after"===n)l.insertBefore(o,c.nextSibling),s=o;else if("replace-selector"===n)l.replaceChild(o,c),s=o;else{if("inner"!==n)return console.warn("error-on-placement"),!1;!0===a?c.innerHTML=i:c.innerText=o,s=c}var u=c;return this.createMap(u),s}},{key:"insert",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inner";return t=this.find(t),this.update(t,e,n,!1)}},{key:"render",value:function(t){var e=document.createElement("template");return e.innerHTML=t,e=e.content.firstElementChild}},{key:"mount",value:function(t,e){if("string"==typeof e)e=this.render(e);if(null!==e){var n=(t=this.find(t)).appendChild(e),r=t;return this.createMap(r),n}console.warn("need to be HTML string or object")}},{key:"settings",value:function(t){if(void 0===t[0]){var e=[],n=0,r=[];for(var o in t)r.push(t[o]);r.forEach(function(t){e[n++]=t});var i=[];n=0;Object.keys(t).forEach(function(t){i[n++]=t});var a="";n=0;return i.forEach(function(t,n){a+=" ".concat(t,'="').concat(e[n],'"')}),a}}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"object"===_typeof(e)&&(e=this.settings(e));var r="<".concat(t).concat(e,">");return r+=n,"br"!==t&&(r+="</".concat(t,">")),r}},{key:"html",value:function(t,e,n){var r=this.replacement;if("code"===t&&(n=r(n,"<","&lt;"),n=r(n,">","&gt;"),n=r(n," ","&nbsp;")),void 0===n)n=e,e="";if("object"===_typeof(n)&&void 0!==n[0]){var o="";n.forEach(function(t,e){o+="".concat(t)});i=this.createTag(t,e,o)}else if("object"===_typeof(n))e=n,i=this.createTag(t,e,n="");else var i=this.createTag(t,e,n);return i}},{key:"el",value:function(t,e,n){return this.html(t,e,n)}}]),t}();